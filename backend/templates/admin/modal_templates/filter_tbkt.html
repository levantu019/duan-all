{% load data_model %}
{% data_fields "quanlydonvi" "donvi" "maNhanDang" "ten" "capDonVi__ten" "loaiDonVi__ten" as data_donvi %}
{% data_fields "quanlytbkt" "loaitrangbikhitai" "maNhanDang" "ten" as data_loaitb %}
{% data_fields "quanlytbkt" "xuatxu" "maNhanDang" "ten" as data_xuatxu %}
{% data_fields "quanlytbkt" "tinhtrang" "maNhanDang" "ten"  as data_tinhtrang %}
{% data_fields "quanlytbkt" "phancapchatluong" "maNhanDang" "ten" as data_pccl %}

<div id="filter-modal" class="modal fade">
    <form id="filter-tbkt-form" action="{{action}}" method="GET">
        <div class="modal-dialog modal-dialog-centered" style="max-width: 1000px">
            <div class="modal-content">
                <div class="modal-header" style="display: flex; text-align: left;">
                    <h5 class="modal-title">Lọc thông tin</h5>
                    <button type="button" class="close" aria-label="Close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body d-flex flex-row"> 
                    <div class="ml-4" style="flex:1">
                        <div class="d-flex justify-content-between pl-1 pr-1 mt-2" >
                            <label style="min-width:180px;margin-top: 0.5rem;" for="filter-input-matrangbi">Mã trang bị</label>
                            <input class="form-control item-filter" id="filter-input-matrangbi" name="maNhanDang" placeholder="Mã trang bị">
                        </div>
                        <div class="d-flex justify-content-between pl-1 pr-1 mt-2" >
                            <label style="min-width:180px;margin-top: 0.5rem;" for="filter-input-tentrangbi">Tên trang bị</label>
                            <input class="form-control item-filter" id="filter-input-tentrangbi" name="ten" placeholder="Tên trang bị">
                        </div>
                        <div class="d-flex justify-content-between pl-1 pr-1 mt-2" >
                            <label style="min-width:180px;margin-top: 0.5rem;" for="filter-input-sohieutb">Số hiệu trang bị</label>
                            <input class="form-control item-filter" id="filter-input-sohieutb" name="soHieu" placeholder="Số hiệu trang bị">
                        </div>
                        <div class="d-flex justify-content-between pl-1 pr-1 mt-2" >
                            <label style="min-width:180px;margin-top: 0.5rem;" for="filter-input-loaitb">Loại trang bị</label>
                            <select class="form-control select-filter item-filter" id="filter-input-loaitb" name="loaiTrangBiKhiTai" placeholder="Loại trang bị">
                                <option class="item-placeholder" value="" selected></option>
                                {% for item in data_loaitb %}
                                    <option value={{item.maNhanDang}}>{{item.ten}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="d-flex justify-content-between pl-1 pr-1 mt-2" >
                            <label style="min-width:180px;margin-top: 0.5rem;" for="filter-input-xuatxu">Xuất xứ</label>
                            <select class="form-control select-filter item-filter" id="filter-input-xuatxu" name="xuatXu" placeholder="Xuất xứ">
                                <option class="item-placeholder" value="" selected></option>
                                {% for item in data_xuatxu %}
                                    <option value={{item.maNhanDang}}>{{item.ten}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="d-flex justify-content-between pl-1 pr-1 mt-2" >
                            <label style="min-width:180px;margin-top: 0.5rem;" for="filter-input-namsx">Năm sản xuất</label>
                            <input class="form-control item-filter" id="filter-input-namsx" name="namSanXuat" placeholder="Năm sản xuất">
                        </div>
                        <div class="d-flex justify-content-between pl-1 pr-1 mt-2" >
                            <label style="min-width:180px;margin-top: 0.5rem;" for="filter-input-tinhtranghd">Tình trạng hoạt động</label>
                            <select class="form-control select-filter item-filter" id="filter-input-tinhtranghd" name="tinhTrang" placeholder="Tình trạng hoạt động">
                                <option class="item-placeholder" value="" selected></option>
                                {% for item in data_tinhtrang %}
                                    <option value={{item.maNhanDang}}>{{item.ten}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="d-flex justify-content-between pl-1 pr-1 mt-2" >
                            <label style="min-width:180px;margin-top: 0.5rem;" for="filter-input-pccl">Phân cấp chất lượng</label>
                            <select class="form-control select-filter item-filter" id="filter-input-pccl" name="phanCapChatLuong" placeholder="Phân cấp chất lượng">
                                <option class="item-placeholder" value="" selected></option>
                                {% for item in data_pccl %}
                                    <option value={{item.maNhanDang}}>{{item.ten}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="d-flex justify-content-between pl-1 pr-1 mt-2" >
                            <label style="min-width:180px;margin-top: 0.5rem;" for="filter-input-donvi">Đơn vị</label>
                            <select class="form-control select-filter item-filter" id="filter-input-donvi" name="donVi">
                                <option class="item-placeholder" value="" selected></option>
                                {% for item in data_donvi %}
                                    <option value={{item.maNhanDang}}>{{item.ten}}{% if item.capDonVi__ten %} - {{item.capDonVi__ten}}{% endif %}{% if item.loaiDonVi__ten %} - {{item.loaiDonVi__ten}}{% endif %}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Lọc</button>
                </div>
            </div>
        </div>
    </form>
</div>

<style>
    .select-filter + span{
        width: 100% !important;
    }
    .select-filter+span>span > span:first-child {
        border-color: #CED4DA;
    }
</style>
<script>
    $(document).ready(function() {
        $('.select-filter').select2({
            width: 'resolve' // need to override the changed default
        });

        $('#filter-tbkt-form').submit(() => {
            $(".item-filter").each((idx, val) => {
                if(!$(val).val()) $(val).removeAttr('name');
            })
        })
    });
</script>
